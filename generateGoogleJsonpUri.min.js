// < URI generator plugin for New Google Spreadsheet >
//
// This is a jQuery plugin.
// Tested with jQuery 1.11.1 and 2.1.1
// Tested on IE8 and Chrome 35
//
// Developed by mecrazy - http://mecrazy.net
//
(function(d){d.genJsonpGDU=function(h){function s(){var a=d("html"),c="gen-jsonp-gdu-"+p;a.hasClass(c)&&!b.cache&&a.removeClass(c);if(!a.hasClass(c)&&b.cache){a.addClass(c);var a=b.cacheInterval.sec,a=a+60*b.cacheInterval.min,a=a+3600*b.cacheInterval.hour,e=n.url({minCol:1,maxCol:1,minRow:1,maxRow:1,withoutcallback:!0});q(a,function(){n.ajax({url:e,success:function(a){for(var b=!1,c=0;c<m.time.length;c++)m.time[c]!=a.feed.updated.$t&&(b=!0,c=m.time.length);b&&(m={url:[],json:[],time:[]})}})})}}function t(a,c){var e={url:n.url({minRow:b.pager.startRow,minCol:b.pager.minCol,maxCol:b.pager.minCol,withoutcallback:!0}),async:!1,dataType:"jsonp",callback:"callback",error:function(a,b,c){l.console.log(a,b,c)},success:function(a){b.pager.allRecs=a.feed.entry.length;b.pager.maxPage=Math.floor(b.pager.allRecs/b.pager.recsPerPage);b.pager.allRecs/b.pager.recsPerPage>b.pager.maxPage&&b.pager.maxPage++;b.pager.prev=1<b.pager.page;b.pager.next=b.pager.page<b.pager.maxPage},complete:function(){"object"==typeof a&&r(a,c)}};"object"==typeof a&&"undefined"!=typeof a.beforeSend&&(e.beforeSend=a.beforeSend,a.beforeSend=null);d.ajax(e);return!0}function r(a,c){if(b.cache){var e=m.url.indexOf(a.url);if(0<=e&&!c)a.success(m.json[e]);else{var f=a.success;a.success=function(b){m.url.push(a.url);m.json.push(b);m.time.push(b.feed.updated.$t);f(b)};d.ajax(a)}}else d.ajax(a)}function q(a,c){setTimeout(function(){b.cache&&(c(),q(a,c))},1E3*a)}var l={console:{log:null},errMsg:[]};"undefined"!=typeof console?l.console=console:l.console.log=function(a){5<=l.errMsg.length&&l.errMsg.splice(4,1);l.errMsg.unshift(a)};var p="";"string"==typeof h?p=h:"object"==typeof h&&"string"==typeof h.key&&(p=h.key);var b={key:p,base1:"https://spreadsheets.google.com/feeds/cells/",base2:"/od6/public/values?alt=json-in-script",pager:{enabled:!1,page:1,maxPage:1,prev:!1,next:!1,recsPerPage:5,allRecs:1,startRow:2,minCol:1,maxCol:1},cache:!1,cacheInterval:{sec:0,min:20,hour:0},firstRequest:!0},m={url:[],json:[],time:[]},n={url:function(a){var c=b.base1+b.key+b.base2;"undefined"==typeof a?c+="&callback=callback":("undefined"!=typeof a.minCol&&(c+="&min-col="+a.minCol),"undefined"!=typeof a.maxCol&&(c+="&max-col="+a.maxCol),"undefined"!=typeof a.minRow&&(c+="&min-row="+a.minRow),"undefined"!=typeof a.maxRow&&(c+="&max-row="+a.maxRow),"string"==typeof a.callback?c+="&callback="+a.callback:"undefined"==typeof a.withoutcallback&&(c+="&callback=callback"));return c},set:function(a){var c=b.cache;b=d.extend(!0,b,a);c!=b.cache&&s();return!0},get:function(){return d.extend(!0,{},b)},pageUrl:function(a,c){1>a?a=1:a>b.pager.maxPage&&(a=b.pager.maxPage);var e=a,f=c,g="";b.pager.enabled?(g=b.pager.startRow,g+=(e-1)*b.pager.recsPerPage,g=n.url({minRow:g,maxRow:g+b.pager.recsPerPage-1,minCol:b.pager.minCol,maxCol:b.pager.maxCol,withoutcallback:!0}),"boolean"!=typeof f&&(f=!0),f&&(b.pager.page=e),b.pager.prev=1<b.pager.page,b.pager.next=b.pager.page<b.pager.maxPage):l.console.log('Pager function is not enabled. Use "pager" function to enable it.');return g},pager:function(a){b.pager=d.extend(b.pager,a);b.pager.enabled="undefined"!=typeof a.startRow&&"undefined"!=typeof a.minCol&&"undefined"!=typeof a.maxCol;return b},ajax:function(a,c){"undefined"==typeof c&&(c=!1);var e=d.extend(!0,{url:n.pageUrl(1,!1),dataType:"jsonp",callback:"callback"},a);b.firstRequest?t(e,c):r(e,c);b.firstRequest=!1},jsonToArr:function(a){var b,e,f,g,d=[],k="undefined"!=typeof a.feed.entry;k&&(k=0<a.feed.entry.length);if(k)for(k=0;k<a.feed.entry.length;k++){var h=a.feed.entry[k].gs$cell.$t;g=Number(a.feed.entry[k].gs$cell.col);f=Number(a.feed.entry[k].gs$cell.row);0===k&&(b=f);0===k&&(e=g);f-=b;for(g-=e;d.length<f+1;)d.push([]);for(;d[f].length<=g;)d[f].push("");d[f][g]=h}return d},showErr:function(){var a="";if(0<l.errMsg.length)for(var b=0;b<l.errMsg.length;b++)a+=l.errMsg[b]+"\r\n\r\n";else a="No error.";alert(a)}};return n}})(jQuery);Array.indexOf||(Array.prototype.indexOf=function(d){for(var h=0;h<this.length;h++)if(this[h]===d)return h;return-1});